<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pico WH RSSI ì¬ë° ê°ì§€ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3a 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .status-indicator {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin: 0 10px;
            animation: pulse 2s infinite;
        }

        .status-normal { background: linear-gradient(45deg, #00ff88, #00cc6a); }
        .status-warning { background: linear-gradient(45deg, #ffa500, #ff8c00); }
        .status-danger { background: linear-gradient(45deg, #ff4444, #cc0000); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .card h3 {
            margin-bottom: 15px;
            color: #00ccff;
            font-size: 1.2em;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }

        .metric-unit {
            font-size: 0.8em;
            opacity: 0.7;
        }

        .chart-container {
            width: 100%;
            height: 200px;
            position: relative;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
        }

        .chart {
            width: 100%;
            height: 100%;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .progress-normal { background: linear-gradient(90deg, #00ff88, #00cc6a); }
        .progress-warning { background: linear-gradient(90deg, #ffa500, #ff8c00); }
        .progress-danger { background: linear-gradient(90deg, #ff4444, #cc0000); }

        .alert-log {
            background: rgba(255, 68, 68, 0.1);
            border-left: 4px solid #ff4444;
            max-height: 150px;
            overflow-y: auto;
        }

        .alert-item {
            padding: 8px 12px;
            border-bottom: 1px solid rgba(255, 68, 68, 0.2);
        }

        .alert-time {
            font-size: 0.8em;
            opacity: 0.7;
        }

        .adaptation-level {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .level-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .level-dot.active {
            background: #00ff88;
            border-color: #00ff88;
            box-shadow: 0 0 10px #00ff88;
        }

        .jamming-indicator {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.5em;
            font-weight: bold;
        }

        .controls {
            text-align: center;
            margin: 20px 0;
        }

        .btn {
            background: linear-gradient(45deg, #00ccff, #0099cc);
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: transform 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff4444, #cc0000);
        }

        .connection-status {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .gemini-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .threshold-display {
            background: rgba(255, 165, 0, 0.2);
            border: 1px solid #ffa500;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
        }

        .rssi-meter {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .rssi-bar {
            width: 100%;
            height: 30px;
            background: linear-gradient(90deg, #ff0000 0%, #ff6600 25%, #ffaa00 50%, #66ff00 75%, #00ff00 100%);
            border-radius: 15px;
            position: relative;
            margin: 10px 0;
        }

        .rssi-indicator {
            position: absolute;
            top: -5px;
            width: 4px;
            height: 40px;
            background: #ffffff;
            border-radius: 2px;
            box-shadow: 0 0 10px #ffffff;
            transition: left 0.3s ease;
        }

        .rssi-scale {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            opacity: 0.7;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ›¡ï¸ Pico WH RSSI ì¬ë° ê°ì§€ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ</h1>
            <div id="systemStatus" class="status-indicator status-normal">ì‹œìŠ¤í…œ ëŒ€ê¸°</div>
            <div id="connectionStatus" class="status-indicator status-warning">Pico ì—°ê²° ì¤‘...</div>
        </div>

        <!-- ì—°ê²° ìƒíƒœ -->
        <div class="connection-status">
            <div>
                <span class="gemini-status" id="picoStatus" style="background: #ffa500;"></span>
                <strong>Raspberry Pi Pico WH:</strong> <span id="picoConnectionText">ì—°ê²° ì‹œë„ ì¤‘...</span>
            </div>
            <div style="margin-top: 5px;">
                <span class="gemini-status" id="geminiStatus" style="background: #ffa500;"></span>
                <strong>Gemini AI:</strong> <span id="geminiConnectionText">API ì—°ê²° ì¤‘...</span>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- ì‹¤ì‹œê°„ RSSI ì¸¡ì • -->
            <div class="card">
                <h3>ğŸ“¡ ì‹¤ì‹œê°„ RSSI ì‹ í˜¸ ê°•ë„</h3>
                <div class="metric-value" id="rssiValue">-80.5 <span class="metric-unit">dBm</span></div>
                <div class="threshold-display">
                    <strong>ì¬ë° ì„ê³„ê°’: -50.0 dBm</strong>
                    <br><small>ì„ê³„ê°’ ì´ìƒì˜ ê°•í•œ ì‹ í˜¸ = ì¬ë° ê³µê²©</small>
                </div>
                <div class="rssi-meter">
                    <div class="rssi-bar">
                        <div id="rssiIndicator" class="rssi-indicator" style="left: 25%;"></div>
                    </div>
                    <div class="rssi-scale">
                        <span>-110</span>
                        <span>-90</span>
                        <span>-70</span>
                        <span>-50</span>
                        <span>-30 dBm</span>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="rssiChart" class="chart"></canvas>
                </div>
                <div class="progress-bar">
                    <div id="rssiProgress" class="progress-fill progress-normal" style="width: 25%"></div>
                </div>
            </div>

            <!-- ê¸°ì¤€ ì£¼íŒŒìˆ˜ -->
            <div class="card">
                <h3>ğŸ¯ ëª¨ë‹ˆí„°ë§ ì£¼íŒŒìˆ˜</h3>
                <div class="metric-value" id="frequencyValue">433.92 <span class="metric-unit">MHz</span></div>
                <div style="margin: 15px 0;">
                    <div>í˜„ì¬ ìŠ¤ìº”: <span id="currentScanFreq">433.92 MHz</span></div>
                    <div>ë‹¤ìŒ ìŠ¤ìº”: <span id="nextScanFreq">868.3 MHz</span></div>
                </div>
                <div class="chart-container">
                    <canvas id="frequencyChart" class="chart"></canvas>
                </div>
                <p style="font-size: 0.9em; opacity: 0.8;">ì£¼íŒŒìˆ˜ëŠ” ê³ ì •, RSSI ë³€í™”ë¡œ ì¬ë° ê°ì§€</p>
            </div>

            <!-- ì‹ í˜¸ ê°•ë„ (ADC ê°’) -->
            <div class="card">
                <h3>ğŸ“Š ì‹ í˜¸ ê°•ë„ (ADC)</h3>
                <div class="metric-value" id="adcValue">1024 <span class="metric-unit">/ 4095</span></div>
                <div class="chart-container">
                    <canvas id="adcChart" class="chart"></canvas>
                </div>
                <div class="progress-bar">
                    <div id="adcProgress" class="progress-fill progress-normal" style="width: 25%"></div>
                </div>
            </div>

            <!-- ì¬ë° ê°ì§€ íšŸìˆ˜ -->
            <div class="card">
                <h3>âš ï¸ ì¬ë° ê°ì§€ íšŸìˆ˜</h3>
                <div class="metric-value" id="jammingCount">0 <span class="metric-unit">íšŒ</span></div>
                <div class="threshold-display">
                    <strong>RSSI > -50 dBm</strong>
                    <br><small>ê°•í•œ ì‹ í˜¸ ê°ì§€ ì‹œ ì¬ë°ìœ¼ë¡œ íŒë‹¨</small>
                </div>
                <div class="progress-bar">
                    <div id="jammingProgress" class="progress-fill progress-normal" style="width: 0%"></div>
                </div>
                <p>ì—°ì† ê°ì§€ ì‹œ ê²½ê³  í™œì„±í™”</p>
            </div>

            <!-- í™˜ê²½ ë°ì´í„° -->
            <div class="card">
                <h3>ğŸŒ¡ï¸ í™˜ê²½ ë°ì´í„°</h3>
                <div style="display: flex; justify-content: space-between;">
                    <div>
                        <div>ì˜¨ë„: <span id="temperature">23.5Â°C</span></div>
                        <div>ìŠµë„: <span id="humidity">45%</span></div>
                    </div>
                    <div>
                        <div>CPU ì˜¨ë„: <span id="cpuTemp">42Â°C</span></div>
                        <div>ë©”ëª¨ë¦¬: <span id="memoryUsage">65%</span></div>
                    </div>
                </div>
            </div>

            <!-- Gemini AI ë¶„ì„ -->
            <div class="card">
                <h3>ğŸ¤– Gemini AI ìœ„í˜‘ ë¶„ì„</h3>
                <div id="aiAnalysis" style="min-height: 100px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                    AI ë¶„ì„ ëŒ€ê¸° ì¤‘...
                </div>
                <div style="margin-top: 10px;">
                    <small>ë§ˆì§€ë§‰ ë¶„ì„: <span id="lastAnalysis">-</span></small>
                </div>
            </div>

            <!-- ì ì‘ ëª¨ë“œ -->
            <div class="card">
                <h3>ğŸ”§ ì ì‘ ëª¨ë“œ</h3>
                <div class="adaptation-level" id="adaptationLevel">
                    <div class="level-dot active"></div>
                    <div class="level-dot"></div>
                    <div class="level-dot"></div>
                </div>
                <p id="adaptationText">ëª¨ë“œ 0: ì •ìƒ ëª¨ë‹ˆí„°ë§</p>
                <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                    <div>ë¯¼ê°ë„: <span id="sensitivityLevel">í‘œì¤€</span></div>
                    <div>ì„ê³„ê°’: <span id="currentThreshold">-50 dBm</span></div>
                </div>
            </div>
        </div>

        <!-- ì¬ë° ìƒíƒœ í‘œì‹œ -->
        <div id="jammingIndicator" class="jamming-indicator" style="background: rgba(0, 255, 136, 0.1); border: 2px solid #00ff88;">
            âœ… ì •ìƒ ìƒíƒœ - RSSI ì„ê³„ê°’ ì´í•˜ (-80.5 dBm)
        </div>

        <!-- ì•Œë¦¼ ë¡œê·¸ -->
        <div class="card alert-log">
            <h3>ğŸš¨ ì‹¤ì‹œê°„ ë¡œê·¸</h3>
            <div id="alertLog">
                <div class="alert-item">
                    <div>RSSI ê¸°ë°˜ ì¬ë° ê°ì§€ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ</div>
                    <div class="alert-time" id="startTime">2025-05-24 10:30:00</div>
                </div>
            </div>
        </div>

        <!-- ì œì–´ ë²„íŠ¼ -->
        <div class="controls">
            <button class="btn" onclick="connectToPico()" id="connectBtn">ğŸ”Œ Pico ì—°ê²°</button>
            <button class="btn" onclick="startMonitoring()" id="monitorBtn">ğŸ” ëª¨ë‹ˆí„°ë§ ì‹œì‘</button>
            <button class="btn" onclick="resetSystem()">ğŸ”„ ì‹œìŠ¤í…œ ë¦¬ì…‹</button>
            <button class="btn btn-danger" onclick="testJamming()">ğŸ§ª ì¬ë° í…ŒìŠ¤íŠ¸</button>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let monitoringActive = false;
        let picoConnected = false;
        let geminiConnected = false;
        let rssiData = [];
        let frequencyData = [];
        let adcData = [];
        let currentRSSI = -80.5; // dBm
        let currentFrequency = 433.92; // MHz (ê¸°ì¤€ ì£¼íŒŒìˆ˜)
        let currentADC = 1024;
        let jammingCount = 0;
        let adaptationMode = 0;
        let jammingDetected = false;
        let testMode = false;

        // RSSI ê¸°ë°˜ ì„ê³„ê°’ ì„¤ì •
        const JAMMING_THRESHOLD_RSSI = -60.0; // dBm (ì´ ê°’ë³´ë‹¤ ë†’ì€ ì‹ í˜¸ëŠ” ì¬ë°ìœ¼ë¡œ íŒë‹¨)
        const CONSECUTIVE_THRESHOLD = 3; // ì—°ì† 3íšŒ ê°ì§€ ì‹œ ê²½ê³ 
        const SENSITIVITY_LEVELS = {
            0: { threshold: -50.0, name: "í‘œì¤€" },
            1: { threshold: -53.0, name: "ë¯¼ê°" },
            2: { threshold: -55.0, name: "ê³ ë¯¼ê°" }
        };

        // ìŠ¤ìº” ì£¼íŒŒìˆ˜ ëª©ë¡
        const SCAN_FREQUENCIES = [433.92, 868.3, 915.0]; // MHz
        let currentScanIndex = 0;

        // WebSocket ë˜ëŠ” ì‹œë¦¬ì–¼ í†µì‹  ê°ì²´
        let picoConnection = null;

        // ì°¨íŠ¸ ì»¨í…ìŠ¤íŠ¸
        let rssiChart, frequencyChart, adcChart;

        // ì´ˆê¸° ë°ì´í„° ìƒì„±
        for(let i = 0; i < 20; i++) {
            rssiData.push(-80.5 + Math.random() * 10 - 5); // -85 ~ -75 dBm ë²”ìœ„
            frequencyData.push(433.92); // ê³ ì • ì£¼íŒŒìˆ˜
            adcData.push(1024 + Math.random() * 400 - 200); // ADC ë³€ë™
        }

        // ì‹¤ì œ CC1101 Pico ì—°ê²° í•¨ìˆ˜
        async function connectToPico() {
            const connectBtn = document.getElementById('connectBtn');
            connectBtn.textContent = 'ğŸ”Œ ì—°ê²° ì¤‘...';
            connectBtn.disabled = true;

            try {
                // ì‹¤ì œ CC1101 Pico ì—°ê²°
                picoConnection = await connectToRealPico();
                picoConnected = true;
                
                document.getElementById('picoStatus').style.background = '#00ff88';
                document.getElementById('picoConnectionText').textContent = 'ì—°ê²°ë¨ - CC1101 RSSI ì‹¤ì‹œê°„ ìˆ˜ì‹ ';
                
                connectBtn.textContent = 'âœ… CC1101 ì—°ê²°ë¨';
                connectBtn.style.background = 'linear-gradient(45deg, #00ff88, #00cc6a)';
                
                addAlert('ğŸ›¡ï¸ CC1101 RSSI ì¬ë° ê°ì§€ ì‹œìŠ¤í…œ ì—°ê²° ì„±ê³µ');
                
                // Gemini AI ì—°ê²° ì‹œë„
                await connectToGemini();
                
            } catch (error) {
                addAlert('âŒ CC1101 Pico ì—°ê²° ì‹¤íŒ¨: ' + error.message);
                connectBtn.textContent = 'ğŸ”Œ ì¬ì—°ê²°';
                connectBtn.disabled = false;
                
                // ì—°ê²° ì‹¤íŒ¨ ì‹œ ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œë¡œ ì „í™˜
                addAlert('âš ï¸ ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œë¡œ ì „í™˜í•©ë‹ˆë‹¤');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                picoConnected = true;
                document.getElementById('picoStatus').style.background = '#ffa500';
                document.getElementById('picoConnectionText').textContent = 'ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ - RSSI í…ŒìŠ¤íŠ¸ ë°ì´í„°';
                
                connectBtn.textContent = 'ğŸ§ª ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ';
                connectBtn.style.background = 'linear-gradient(45deg, #ffa500, #ff8c00)';
                
                await connectToGemini();
            }
        }

        // Gemini API ì—°ê²°
        async function connectToGemini() {
            try {
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                geminiConnected = true;
                document.getElementById('geminiStatus').style.background = '#00ff88';
                document.getElementById('geminiConnectionText').textContent = 'ì—°ê²°ë¨ - RSSI ë¶„ì„ ì¤€ë¹„';
                
                addAlert('ğŸ¤– Gemini AI ì—°ê²° ì„±ê³µ - RSSI íŒ¨í„´ ë¶„ì„ ê°€ëŠ¥');
                
            } catch (error) {
                addAlert('âŒ Gemini AI ì—°ê²° ì‹¤íŒ¨');
                document.getElementById('geminiStatus').style.background = '#ff4444';
                document.getElementById('geminiConnectionText').textContent = 'ì—°ê²° ì‹¤íŒ¨';
            }
        }

        // ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸
        function updateSensorData() {
            if (!picoConnected) return;

            // ì‹¤ì œ CC1101 ì—°ê²°ì´ ì•„ë‹Œ ê²½ìš°ë§Œ ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° ì‚¬ìš©
            if (!picoConnection) {
                // ì£¼íŒŒìˆ˜ ìŠ¤ìº” ì‹œë®¬ë ˆì´ì…˜
                currentFrequency = SCAN_FREQUENCIES[currentScanIndex];
                currentScanIndex = (currentScanIndex + 1) % SCAN_FREQUENCIES.length;
                
                // í…ŒìŠ¤íŠ¸ ëª¨ë“œì¼ ë•Œ ì¬ë° ì‹œë®¬ë ˆì´ì…˜ (ê°•í•œ RSSI)
                if (testMode) {
                    currentRSSI = -50.0 + Math.random() * 20; // -50 ~ -30 dBm (ì¬ë° ë²”ìœ„)
                    currentADC = 3500 + Math.random() * 500;
                } else {
                    // ì •ìƒ ë²”ìœ„ì˜ ëœë¤ ë°ì´í„°
                    currentRSSI = -80.5 + Math.random() * 10 - 5; // -85 ~ -75 dBm
                    currentADC = 1024 + Math.random() * 400 - 200;
                }

                // ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œì—ì„œë§Œ ë°ì´í„° ë°°ì—´ ì—…ë°ì´íŠ¸
                rssiData.push(currentRSSI);
                frequencyData.push(currentFrequency);
                adcData.push(currentADC);
                
                if (rssiData.length > 20) {
                    rssiData.shift();
                    frequencyData.shift();
                    adcData.shift();
                }

                // UI ì—…ë°ì´íŠ¸
                updateUI();
                
                // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                drawCharts();
                
                // ì¬ë° ê°ì§€ ë¡œì§ (RSSI ê¸°ë°˜)
                detectJamming();
                
                // AI ë¶„ì„ (ì£¼ê¸°ì ìœ¼ë¡œ)
                if (Math.random() < 0.1) {
                    performAIAnalysis();
                }
            }
        }

        function updateUI() {
            console.log(`ğŸ¯ updateUI í˜¸ì¶œë¨: RSSI=${currentRSSI}, FREQ=${currentFrequency}, ADC=${currentADC}`);
            
            // RSSI ê°’ ì—…ë°ì´íŠ¸
            const rssiElement = document.getElementById('rssiValue');
            if (rssiElement) {
                rssiElement.innerHTML = `${currentRSSI.toFixed(1)} <span class="metric-unit">dBm</span>`;
                console.log(`ğŸ“Š RSSI ì—…ë°ì´íŠ¸: ${currentRSSI.toFixed(1)}dBm`);
            }
            
            // ì£¼íŒŒìˆ˜ ê°’ ì—…ë°ì´íŠ¸ (í˜„ì¬ ìŠ¤ìº” ì¤‘ì¸ ì£¼íŒŒìˆ˜)
            const freqElement = document.getElementById('frequencyValue');
            if (freqElement) {
                freqElement.innerHTML = `${currentFrequency.toFixed(2)} <span class="metric-unit">MHz</span>`;
            }
            
            // ADC ê°’ ì—…ë°ì´íŠ¸
            const adcElement = document.getElementById('adcValue');
            if (adcElement) {
                adcElement.innerHTML = `${Math.round(currentADC)} <span class="metric-unit">/ 4095</span>`;
            }
            
            // ì¬ë° ì¹´ìš´í„° ì—…ë°ì´íŠ¸
            const jammingElement = document.getElementById('jammingCount');
            if (jammingElement) {
                jammingElement.innerHTML = `${jammingCount} <span class="metric-unit">íšŒ</span>`;
            }

            // ìŠ¤ìº” ì£¼íŒŒìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
            const currentScanElement = document.getElementById('currentScanFreq');
            const nextScanElement = document.getElementById('nextScanFreq');
            if (currentScanElement && nextScanElement) {
                currentScanElement.textContent = `${currentFrequency.toFixed(2)} MHz`;
                const nextIndex = (SCAN_FREQUENCIES.indexOf(currentFrequency) + 1) % SCAN_FREQUENCIES.length;
                nextScanElement.textContent = `${SCAN_FREQUENCIES[nextIndex].toFixed(2)} MHz`;
            }

            // RSSI ë¯¸í„° ì—…ë°ì´íŠ¸
            updateRSSIMeter();

            // í™˜ê²½ ë°ì´í„° ì‹œë®¬ë ˆì´ì…˜
            if (picoConnection) {
                // ì‹¤ì œ ì—°ê²° ì‹œ ê³ ì •ê°’ ì‚¬ìš©
                document.getElementById('temperature').textContent = '24.2Â°C';
                document.getElementById('humidity').textContent = '48%';
                document.getElementById('cpuTemp').textContent = '45Â°C';
                document.getElementById('memoryUsage').textContent = '70%';
            } else {
                // ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œì¼ ë•Œë§Œ ëœë¤ ê°’
                document.getElementById('temperature').textContent = 
                    (23.5 + Math.random() * 2 - 1).toFixed(1) + 'Â°C';
                document.getElementById('humidity').textContent = 
                    Math.round(45 + Math.random() * 10 - 5) + '%';
                document.getElementById('cpuTemp').textContent = 
                    Math.round(42 + Math.random() * 8 - 4) + 'Â°C';
                document.getElementById('memoryUsage').textContent = 
                    Math.round(65 + Math.random() * 20 - 10) + '%';
            }

            updateProgressBars();
            updateAdaptationUI();
        }

        function updateRSSIMeter() {
            // RSSIë¥¼ -110 ~ -30 dBm ë²”ìœ„ë¡œ ì •ê·œí™”í•˜ì—¬ 0-100% ìœ„ì¹˜ ê³„ì‚°
            const rssiPercent = Math.max(0, Math.min(100, ((currentRSSI + 110) / 80) * 100));
            const rssiIndicator = document.getElementById('rssiIndicator');
            if (rssiIndicator) {
                rssiIndicator.style.left = rssiPercent + '%';
            }
        }

        function updateProgressBars() {
            // RSSI ì§„í–‰ë¥  (ì„ê³„ê°’ ëŒ€ë¹„) - ë†’ì€ ê°’ì¼ìˆ˜ë¡ ìœ„í—˜
            // -110dBm = 0%, -50dBm(ì„ê³„ê°’) = 62.5%, -30dBm = 100%
            const rssiPercent = Math.max(0, Math.min(100, ((currentRSSI + 110) / 80) * 100));
            const rssiProgress = document.getElementById('rssiProgress');
            if (rssiProgress) {
                rssiProgress.style.width = rssiPercent + '%';
                
                // RSSIê°€ ì„ê³„ê°’ë³´ë‹¤ ë†’ìœ¼ë©´ ìœ„í—˜
                const currentThreshold = SENSITIVITY_LEVELS[adaptationMode].threshold;
                rssiProgress.className = `progress-fill ${
                    currentRSSI >= currentThreshold ? 'progress-danger' : 
                    currentRSSI >= currentThreshold - 10 ? 'progress-warning' : 'progress-normal'
                }`;
            }

            // ADC ì§„í–‰ë¥ 
            const adcPercent = (currentADC / 4095) * 100;
            const adcProgress = document.getElementById('adcProgress');
            if (adcProgress) {
                adcProgress.style.width = adcPercent + '%';
                adcProgress.className = `progress-fill ${
                    adcPercent >= 85 ? 'progress-danger' : 
                    adcPercent >= 70 ? 'progress-warning' : 'progress-normal'
                }`;
            }

            // ì¬ë° ì¹´ìš´í„° ì§„í–‰ë¥ 
            const jammingPercent = Math.min(100, (jammingCount / 10) * 100);
            const jammingProgressBar = document.getElementById('jammingProgress');
            if (jammingProgressBar) {
                jammingProgressBar.style.width = jammingPercent + '%';
                jammingProgressBar.className = `progress-fill ${
                    jammingPercent >= 70 ? 'progress-danger' : 
                    jammingPercent >= 40 ? 'progress-warning' : 'progress-normal'
                }`;
            }
        }

        function detectJamming() {
            let previousJammingState = jammingDetected;
            
            // í˜„ì¬ ì ì‘ ëª¨ë“œì— ë”°ë¥¸ ì„ê³„ê°’ ì‚¬ìš©
            const currentThreshold = SENSITIVITY_LEVELS[adaptationMode].threshold;

            // RSSIê°€ ì„ê³„ê°’ì„ ì´ˆê³¼í•˜ë©´ ì¬ë° ê°ì§€ (ë†’ì€ ê°’ = ê°•í•œ ì‹ í˜¸ = ì¬ë°)
            if (currentRSSI >= currentThreshold) {
                if (!jammingDetected) {
                    jammingCount++;
                    jammingDetected = true;
                    addAlert(`ğŸš¨ RSSI ì¬ë° ê°ì§€! ì‹ í˜¸ê°•ë„: ${currentRSSI.toFixed(1)}dBm (ì„ê³„ê°’: ${currentThreshold}dBm)`);
                }
            } else {
                jammingDetected = false;
            }

            // ì ì‘ ëª¨ë“œ ì—…ë°ì´íŠ¸ (ì¬ë° íšŸìˆ˜ì— ë”°ë¼)
            if (jammingCount >= CONSECUTIVE_THRESHOLD * 2) {
                adaptationMode = 2; // ê³ ë¯¼ê° ëª¨ë“œ
            } else if (jammingCount >= CONSECUTIVE_THRESHOLD) {
                adaptationMode = 1; // ë¯¼ê° ëª¨ë“œ
            } else {
                adaptationMode = 0; // í‘œì¤€ ëª¨ë“œ
            }

            updateSystemStatus();
        }

        function updateAdaptationUI() {
            const levelDots = document.querySelectorAll('.level-dot');
            levelDots.forEach((dot, index) => {
                dot.classList.toggle('active', index <= adaptationMode);
            });

            const adaptationTexts = [
                'ëª¨ë“œ 0: ì •ìƒ ëª¨ë‹ˆí„°ë§',
                'ëª¨ë“œ 1: ë¯¼ê° ìƒíƒœ - ì„ê³„ê°’ ë‚®ì¶¤',
                'ëª¨ë“œ 2: ê³ ë¯¼ê° ìƒíƒœ - ìµœëŒ€ ê²½ê³„'
            ];
            
            const currentSetting = SENSITIVITY_LEVELS[adaptationMode];
            document.getElementById('adaptationText').textContent = adaptationTexts[adaptationMode];
            document.getElementById('sensitivityLevel').textContent = currentSetting.name;
            document.getElementById('currentThreshold').textContent = `${currentSetting.threshold} dBm`;
        }

        function updateSystemStatus() {
            const systemStatus = document.getElementById('systemStatus');
            const connectionStatus = document.getElementById('connectionStatus');
            const jammingIndicator = document.getElementById('jammingIndicator');

            if (jammingDetected) {
                systemStatus.textContent = 'ğŸš¨ RSSI ì¬ë° ê°ì§€ë¨';
                systemStatus.className = 'status-indicator status-danger';
                
                connectionStatus.textContent = 'ìœ„í—˜ ìƒíƒœ';
                connectionStatus.className = 'status-indicator status-danger';
                
                jammingIndicator.innerHTML = `ğŸš¨ RSSI ì¬ë° ê³µê²© ê°ì§€! - ì‹ í˜¸ê°•ë„: ${currentRSSI.toFixed(1)}dBm`;
                jammingIndicator.style.background = 'rgba(255, 68, 68, 0.2)';
                jammingIndicator.style.borderColor = '#ff4444';
                
            } else if (adaptationMode > 0) {
                systemStatus.textContent = 'âš ï¸ ê²½ê³„ ìƒíƒœ';
                systemStatus.className = 'status-indicator status-warning';
                
                connectionStatus.textContent = 'ì£¼ì˜ í•„ìš”';
                connectionStatus.className = 'status-indicator status-warning';
                
                jammingIndicator.innerHTML = `âš ï¸ ê²½ê³„ ìƒíƒœ - ê³¼ê±° RSSI ì¬ë° ê°ì§€ë¨ (${jammingCount}íšŒ)`;
                jammingIndicator.style.background = 'rgba(255, 165, 0, 0.2)';
                jammingIndicator.style.borderColor = '#ffa500';
                
            } else {
                systemStatus.textContent = 'ì‹œìŠ¤í…œ ì •ìƒ';
                systemStatus.className = 'status-indicator status-normal';
                
                connectionStatus.textContent = 'Pico ì—°ê²°ë¨';
                connectionStatus.className = 'status-indicator status-normal';
                
                jammingIndicator.innerHTML = `âœ… ì •ìƒ ìƒíƒœ - RSSI ì„ê³„ê°’ ì´í•˜ (${currentRSSI.toFixed(1)} dBm)`;
                jammingIndicator.style.background = 'rgba(0, 255, 136, 0.1)';
                jammingIndicator.style.borderColor = '#00ff88';
            }
        }

        // Gemini AI ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜
        async function performAIAnalysis() {
            if (!geminiConnected) return;

            const analysisDiv = document.getElementById('aiAnalysis');
            analysisDiv.innerHTML = 'ğŸ¤– RSSI íŒ¨í„´ ë¶„ì„ ì¤‘...';

            await new Promise(resolve => setTimeout(resolve, 1000));

            let analysis = '';
            const currentThreshold = SENSITIVITY_LEVELS[adaptationMode].threshold;
            
            if (jammingDetected) {
                analysis = `âš ï¸ ìœ„í—˜: RSSI ${currentRSSI.toFixed(1)}dBm ê°ì§€ (ì„ê³„ê°’: ${currentThreshold}dBm). 
                          ê°•í•œ ì‹ í˜¸ë¡œ ì¸í•œ ì¬ë° ê³µê²© ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. 
                          ì¦‰ì‹œ ëŒ€ì‘ ì¡°ì¹˜ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.`;
            } else if (adaptationMode > 0) {
                analysis = `ğŸ“Š ì£¼ì˜: ê³¼ê±° ${jammingCount}íšŒ RSSI ì¬ë° ê°ì§€. 
                          í˜„ì¬ ì‹ í˜¸ê°•ë„ëŠ” ${currentRSSI.toFixed(1)}dBmë¡œ ì•ˆì „í•˜ë‚˜ ì§€ì† ëª¨ë‹ˆí„°ë§ í•„ìš”.
                          ë¯¼ê°ë„ê°€ ${SENSITIVITY_LEVELS[adaptationMode].name} ëª¨ë“œë¡œ ì¡°ì •ë¨.`;
            } else {
                analysis = `âœ… ì •ìƒ: RSSI ${currentRSSI.toFixed(1)}dBm (ì„ê³„ê°’: ${currentThreshold}dBm). 
                          ì‹ í˜¸ ê°•ë„ê°€ ì •ìƒ ë²”ìœ„ì…ë‹ˆë‹¤. í™˜ê²½ì´ ì•ˆì •ì ì…ë‹ˆë‹¤.`;
            }

            analysisDiv.innerHTML = analysis;
            document.getElementById('lastAnalysis').textContent = new Date().toLocaleTimeString('ko-KR');
        }

        function drawCharts() {
            if (!rssiChart || !frequencyChart || !adcChart) return;

            // RSSI ì°¨íŠ¸ - Yì¶• ë²”ìœ„ë¥¼ -110 ~ -30 dBmìœ¼ë¡œ ì„¤ì •
            rssiChart.clearRect(0, 0, rssiChart.canvas.width, rssiChart.canvas.height);
            const currentThreshold = SENSITIVITY_LEVELS[adaptationMode].threshold;
            drawLineChartWithThreshold(rssiChart, rssiData, -110, -30, '#ff6b6b', currentThreshold, 'RSSI');

            // ì£¼íŒŒìˆ˜ ì°¨íŠ¸ - ìŠ¤ìº” ì£¼íŒŒìˆ˜ í‘œì‹œ
            frequencyChart.clearRect(0, 0, frequencyChart.canvas.width, frequencyChart.canvas.height);
            drawLineChart(frequencyChart, frequencyData, 400, 950, '#00ccff');

            // ADC ì°¨íŠ¸
            adcChart.clearRect(0, 0, adcChart.canvas.width, adcChart.canvas.height);
            drawLineChart(adcChart, adcData, 0, 4095, '#00ff88');
        }

        function drawLineChartWithThreshold(ctx, data, minY, maxY, color, threshold, label) {
            const canvas = ctx.canvas;
            const width = canvas.width;
            const height = canvas.height;
            
            // ì„ê³„ê°’ ì„  ê·¸ë¦¬ê¸°
            const thresholdY = height - ((threshold - minY) / (maxY - minY)) * height;
            ctx.strokeStyle = '#ff4444';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, thresholdY);
            ctx.lineTo(width, thresholdY);
            ctx.stroke();
            ctx.setLineDash([]);

            // ì„ê³„ê°’ ë¼ë²¨
            ctx.fillStyle = '#ff4444';
            ctx.font = '12px Arial';
            ctx.fillText(`ì„ê³„ê°’: ${threshold}dBm`, 10, thresholdY - 5);

            // ë°ì´í„° ì„  ê·¸ë¦¬ê¸°
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();

            for(let i = 0; i < data.length; i++) {
                const x = (i / (data.length - 1)) * width;
                const y = height - ((data[i] - minY) / (maxY - minY)) * height;
                
                if(i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();

            // í˜„ì¬ ê°’ ì  ê·¸ë¦¬ê¸°
            if(data.length > 0) {
                const lastX = width - 5;
                const lastY = height - ((data[data.length - 1] - minY) / (maxY - minY)) * height;
                
                ctx.fillStyle = data[data.length - 1] >= threshold ? '#ff4444' : color;
                ctx.beginPath();
                ctx.arc(lastX, lastY, 4, 0, 2 * Math.PI);
                ctx.fill();
            }
        }

        function drawLineChart(ctx, data, minY, maxY, color) {
            const canvas = ctx.canvas;
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();

            for(let i = 0; i < data.length; i++) {
                const x = (i / (data.length - 1)) * width;
                const y = height - ((data[i] - minY) / (maxY - minY)) * height;
                
                if(i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();

            // í˜„ì¬ ê°’ ì  ê·¸ë¦¬ê¸°
            if(data.length > 0) {
                const lastX = width - 5;
                const lastY = height - ((data[data.length - 1] - minY) / (maxY - minY)) * height;
                
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(lastX, lastY, 4, 0, 2 * Math.PI);
                ctx.fill();
            }
        }

        function addAlert(message) {
            const alertLog = document.getElementById('alertLog');
            const now = new Date().toLocaleString('ko-KR');
            
            const alertItem = document.createElement('div');
            alertItem.className = 'alert-item';
            alertItem.innerHTML = `
                <div>${message}</div>
                <div class="alert-time">${now}</div>
            `;
            
            alertLog.insertBefore(alertItem, alertLog.firstChild);
            
            // ìµœëŒ€ 15ê°œ ì•Œë¦¼ë§Œ ìœ ì§€
            while(alertLog.children.length > 15) {
                alertLog.removeChild(alertLog.lastChild);
            }
        }

        // ëª¨ë‹ˆí„°ë§ ì‹œì‘
        function startMonitoring() {
            if (!picoConnected) {
                addAlert('âŒ Pico ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤');
                return;
            }

            if (!monitoringActive) {
                monitoringActive = true;
                const monitorBtn = document.getElementById('monitorBtn');
                monitorBtn.textContent = 'â¹ï¸ ëª¨ë‹ˆí„°ë§ ì¤‘ì§€';
                monitorBtn.onclick = stopMonitoring;
                
                addAlert('ğŸ” RSSI ê¸°ë°˜ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì‹œì‘');
                
                // 1ì´ˆë§ˆë‹¤ ì„¼ì„œ ë°ì´í„° ì—…ë°ì´íŠ¸
                const monitorInterval = setInterval(() => {
                    if (monitoringActive) {
                        updateSensorData();
                    } else {
                        clearInterval(monitorInterval);
                    }
                }, 1000);
            }
        }

        // ëª¨ë‹ˆí„°ë§ ì¤‘ì§€
        function stopMonitoring() {
            monitoringActive = false;
            const monitorBtn = document.getElementById('monitorBtn');
            monitorBtn.textContent = 'ğŸ” ëª¨ë‹ˆí„°ë§ ì‹œì‘';
            monitorBtn.onclick = startMonitoring;
            
            addAlert('â¹ï¸ RSSI ëª¨ë‹ˆí„°ë§ ì¤‘ì§€ë¨');
        }

        // ì‹œìŠ¤í…œ ë¦¬ì…‹
        function resetSystem() {
            jammingDetected = false;
            adaptationMode = 0;
            jammingCount = 0;
            currentRSSI = -80.5;
            currentFrequency = 433.92;
            currentADC = 1024;
            testMode = false;
            currentScanIndex = 0;
            
            // ë°ì´í„° ë°°ì—´ ì´ˆê¸°í™”
            rssiData = [];
            frequencyData = [];
            adcData = [];
            for(let i = 0; i < 20; i++) {
                rssiData.push(-80.5 + Math.random() * 10 - 5);
                frequencyData.push(433.92);
                adcData.push(1024 + Math.random() * 400 - 200);
            }
            
            addAlert('ğŸ”„ RSSI ì¬ë° ê°ì§€ ì‹œìŠ¤í…œ ë¦¬ì…‹ ì™„ë£Œ');
            updateUI();
            updateSystemStatus();
            drawCharts();
        }

        // ì¬ë° í…ŒìŠ¤íŠ¸ ëª¨ë“œ
        function testJamming() {
            testMode = !testMode;
            const testBtn = event.target;
            
            if (testMode) {
                testBtn.textContent = 'ğŸ›‘ í…ŒìŠ¤íŠ¸ ì¤‘ì§€';
                testBtn.style.background = 'linear-gradient(45deg, #ff8800, #ff6600)';
                addAlert('ğŸ§ª RSSI ì¬ë° í…ŒìŠ¤íŠ¸ ëª¨ë“œ í™œì„±í™” - ê°•í•œ ì‹ í˜¸ ì‹œë®¬ë ˆì´ì…˜ (-50 ~ -30 dBm)');
            } else {
                testBtn.textContent = 'ğŸ§ª ì¬ë° í…ŒìŠ¤íŠ¸';
                testBtn.style.background = 'linear-gradient(45deg, #ff4444, #cc0000)';
                addAlert('ğŸ§ª RSSI ì¬ë° í…ŒìŠ¤íŠ¸ ëª¨ë“œ ë¹„í™œì„±í™”');
            }
        }

        // ì‹¤ì œ Pico ë°ì´í„° íŒŒì‹± í•¨ìˆ˜
        function parseSerialData(data) {
            try {
                // CC1101ì—ì„œ ì „ì†¡í•˜ëŠ” ë°ì´í„° í˜•ì‹: "RSSI:-45.2,FREQ:433.92,ADC:3000,JAM:1"
                const values = data.split(',');
                
                values.forEach(value => {
                    const [key, val] = value.split(':');
                    switch(key) {
                        case 'RSSI':
                            currentRSSI = parseFloat(val);
                            break;
                        case 'FREQ':
                            currentFrequency = parseFloat(val);
                            break;
                        case 'ADC':
                            currentADC = parseInt(val);
                            break;
                        case 'JAM':
                            jammingCount = parseInt(val);
                            break;
                        case 'TEMP':
                            // ì˜¨ë„ ë°ì´í„° ì²˜ë¦¬ (ì„ íƒì‚¬í•­)
                            break;
                    }
                });
                
                // ì°¨íŠ¸ ë°ì´í„° ë°°ì—´ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
                rssiData.push(currentRSSI);
                frequencyData.push(currentFrequency);
                adcData.push(currentADC);
                
                // ë°°ì—´ í¬ê¸° ì œí•œ (ìµœëŒ€ 20ê°œ ë°ì´í„° í¬ì¸íŠ¸)
                if (rssiData.length > 20) {
                    rssiData.shift();
                    frequencyData.shift();
                    adcData.shift();
                }
                
                console.log(`ğŸ“Š ë°ì´í„° ì—…ë°ì´íŠ¸: RSSI=${currentRSSI}dBm, FREQ=${currentFrequency}MHz, ADC=${currentADC}, ë°°ì—´ê¸¸ì´=${rssiData.length}`);
                
                return true;
            } catch (error) {
                console.error('CC1101 ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', error);
                return false;
            }
        }

        // Web Serial APIë¥¼ ì‚¬ìš©í•œ ì‹¤ì œ CC1101 Pico ì—°ê²°
        async function connectToRealPico() {
            try {
                if (!('serial' in navigator)) {
                    throw new Error('Web Serial APIê°€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chrome ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.');
                }

                addAlert('ğŸ” ì‹œë¦¬ì–¼ í¬íŠ¸ ê²€ìƒ‰ ì¤‘...');

                const port = await navigator.serial.requestPort();
                
                addAlert('ğŸ“‹ í¬íŠ¸ ì„ íƒë¨ - ì—°ê²° ì‹œë„ ì¤‘...');

                try {
                    if (port.readable) {
                        await port.close();
                        addAlert('ğŸ”„ ê¸°ì¡´ ì—°ê²° ì •ë¦¬ë¨');
                    }
                } catch (e) {
                    console.log('ê¸°ì¡´ ì—°ê²° ì •ë¦¬ ì¤‘ ì˜¤ë¥˜ (ë¬´ì‹œ ê°€ëŠ¥):', e);
                }

                await new Promise(resolve => setTimeout(resolve, 500));
                
                const baudRates = [115200, 9600, 57600, 38400];
                let connected = false;
                let connectedBaud = 0;

                for (let baudRate of baudRates) {
                    try {
                        addAlert(`ğŸ”Œ ë³´ìœ¨ ${baudRate}ë¡œ ì—°ê²° ì‹œë„...`);
                        
                        await port.open({ 
                            baudRate: baudRate,
                            dataBits: 8,
                            stopBits: 1,
                            parity: 'none',
                            flowControl: 'none'
                        });
                        
                        connected = true;
                        connectedBaud = baudRate;
                        addAlert(`âœ… ë³´ìœ¨ ${baudRate}ë¡œ ì—°ê²° ì„±ê³µ!`);
                        break;
                        
                    } catch (error) {
                        console.log(`ë³´ìœ¨ ${baudRate} ì—°ê²° ì‹¤íŒ¨:`, error);
                        try {
                            if (port.readable) await port.close();
                        } catch (e) {}
                        await new Promise(resolve => setTimeout(resolve, 200));
                    }
                }

                if (!connected) {
                    throw new Error('ëª¨ë“  ë³´ìœ¨ì—ì„œ ì—°ê²° ì‹¤íŒ¨. Picoê°€ ì—°ê²°ë˜ì–´ ìˆê³  ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ì—ì„œ ì‚¬ìš© ì¤‘ì´ ì•„ë‹Œì§€ í™•ì¸í•˜ì„¸ìš”.');
                }
                
                addAlert(`ğŸ¯ ì‹œë¦¬ì–¼ í¬íŠ¸ ì—°ê²° ì„±ê³µ (${connectedBaud} baud)`);
                
                const textDecoder = new TextDecoderStream();
                const readableStreamClosed = port.readable.pipeTo(textDecoder.writable);
                const reader = textDecoder.readable.getReader();

                let lastDataTime = Date.now();
                let dataReceived = false;

                const readLoop = async () => {
                    try {
                        while (true) {
                            const { value, done } = await reader.read();
                            if (done) {
                                addAlert('âš ï¸ ì‹œë¦¬ì–¼ ì—°ê²° ì¢…ë£Œë¨');
                                break;
                            }
                            
                            dataReceived = true;
                            lastDataTime = Date.now();
                            
                            const lines = value.split('\n');
                            for (let line of lines) {
                                line = line.trim();
                                if (line) {
                                    console.log(`ğŸ“¥ ìˆ˜ì‹ : ${line}`);
                                    
                                    if (parseSerialData(line)) {
                                        console.log(`ğŸ”„ UI ì—…ë°ì´íŠ¸ ì‹œì‘: RSSI=${currentRSSI}, FREQ=${currentFrequency}, ADC=${currentADC}`);
                                        
                                        updateUI();
                                        updateProgressBars();
                                        drawCharts();
                                        detectJamming();
                                        updateSystemStatus();
                                        
                                        console.log(`âœ… UI ì—…ë°ì´íŠ¸ ì™„ë£Œ`);
                                        
                                        if (Math.random() < 0.1) {
                                            performAIAnalysis();
                                        }
                                    } else {
                                        if (line.length > 0) {
                                            addAlert(`ğŸ“„ Pico ë©”ì‹œì§€: ${line.substring(0, 50)}${line.length > 50 ? '...' : ''}`);
                                        }
                                    }
                                }
                            }
                        }
                    } catch (error) {
                        console.error('ì‹œë¦¬ì–¼ ë°ì´í„° ì½ê¸° ì˜¤ë¥˜:', error);
                        addAlert(`âŒ ë°ì´í„° ì½ê¸° ì˜¤ë¥˜: ${error.message}`);
                    }
                };

                const connectionMonitor = setInterval(() => {
                    const now = Date.now();
                    if (dataReceived && (now - lastDataTime > 10000)) {
                        addAlert('âš ï¸ ë°ì´í„° ìˆ˜ì‹ ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤');
                        clearInterval(connectionMonitor);
                    }
                }, 5000);

                readLoop();
                
                setTimeout(() => {
                    if (!dataReceived) {
                        addAlert('âš ï¸ ì•„ì§ ë°ì´í„°ê°€ ìˆ˜ì‹ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. Picoì—ì„œ main.pyê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
                    }
                }, 3000);
                
                return port;
                
            } catch (error) {
                if (error.name === 'NotFoundError') {
                    throw new Error('í¬íŠ¸ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                } else if (error.message.includes('Failed to open')) {
                    throw new Error('í¬íŠ¸ ì—´ê¸° ì‹¤íŒ¨. ë‹¤ë¥¸ í”„ë¡œê·¸ë¨(Thonny, Arduino IDE ë“±)ì—ì„œ í¬íŠ¸ë¥¼ ì‚¬ìš© ì¤‘ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª¨ë“  ì‹œë¦¬ì–¼ í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•˜ê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
                } else {
                    throw new Error(`ì—°ê²° ì˜¤ë¥˜: ${error.message}`);
                }
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            document.getElementById('startTime').textContent = new Date().toLocaleString('ko-KR');
            
            const canvases = document.querySelectorAll('canvas');
            canvases.forEach(canvas => {
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = rect.height;
            });
            
            rssiChart = document.getElementById('rssiChart').getContext('2d');
            frequencyChart = document.getElementById('frequencyChart').getContext('2d');
            adcChart = document.getElementById('adcChart').getContext('2d');
            
            drawCharts();
            updateUI();
            updateSystemStatus();
            
            addAlert('ğŸ’» CC1101 RSSI ì¬ë° ê°ì§€ ëŒ€ì‹œë³´ë“œ ì¤€ë¹„ ì™„ë£Œ');
        };

        window.onresize = function() {
            const canvases = document.querySelectorAll('canvas');
            canvases.forEach(canvas => {
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = rect.height;
            });
            drawCharts();
        };
    </script>
</body>
</html>
